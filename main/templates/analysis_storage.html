
{% block content %}

<div class="header-container">
    <h2>Analysis storage</h2>
    <div class="button-container">
        <button class="styled-btn"onclick="createNewFolder()">New folder</button>
        <button class="report" onclick="openFolderSelectModalForReporting()">Reporting</button>
    </div>
</div>

<table>
    <thead>
        <tr>
            <th>Number</th>
            <th>Folder name</th>
            <th>Count</th>
            <th>Date of creation</th>
            <th>Edit</th>
        </tr>
    </thead>
    <tbody>
        {% for folder in folders %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td><a href="javascript:void(0);" onclick="showImagesInFolder('{{ folder.name }}')">{{ folder.name }}</a></td>
            <td>{{ folder.count }}</td>
            <td>{{ folder.creation_date|date:"Y-m-d" }}</td>
            <td class="actions">
                <button onclick="editFolder('{{ folder.name }}')">Edit</button>
                <button class="delete" onclick="deleteFolder('{{ folder.name }}')">Delete</button>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">The folder does not exist.</td>
        </tr>
        {% endfor %}
    </tbody>    
</table>

<!-- 리포팅 모달 -->
<div id="reportingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center;">
    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 300px; width: 100%; position: relative;">
        <button onclick="closeReportingModal()" style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 18px; cursor: pointer;">&times;</button>
        <h3>Select a reporting folder</h3>
        <label for="folderSelect">Floder:</label>
        <select id="folderSelect" style="width: 100%; margin-bottom: 15px;">
            <option value="">Please select a folder</option>
            {% for folder in folders %}
            <option value="{{ folder.name }}">{{ folder.name }}</option>
            {% endfor %}
        </select>
        <button onclick="startReporting()" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; margin-top: 10px;">Start reporting</button>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    // 페이지 로드 직후 HTML이 보이지 않도록 설정
    document.body.style.display = 'none';
    
    if (performance.navigation.type === performance.navigation.TYPE_RELOAD) {
        // 새로고침한 경우 마이페이지로 이동
        window.location.href = "{% url 'mypage' %}";
    } else {
        // 새로고침이 아닌 경우에는 페이지 내용을 보이도록 설정
        document.body.style.display = 'block';
    }
});

</script>
{% endblock %}
